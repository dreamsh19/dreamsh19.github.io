<!DOCTYPE html>
<!--
  Minimal Mistakes Jekyll Theme 4.21.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
--><html lang="en" class="no-js">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Jersey Singleton 객체의 초기화 시점 - 기술을 기술하다</title>
<meta name="description" content="이슈    현재 운영 중인 Jersey 기반의 서비스 중에 애플리케이션 구동 시점에 응답시간이 지연되는 이슈가 있었다.   구동 시점에만 이슈가 발생했기 때문에 무엇인가 초기화가 늦어지는 것으로 추측하고, 살펴보기 시작했다.">


  <meta name="author" content="ㅎㅅㅎ">
  
  <meta property="article:author" content="ㅎㅅㅎ">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="기술을 기술하다">
<meta property="og:title" content="Jersey Singleton 객체의 초기화 시점">
<meta property="og:url" content="https://dreamsh19.github.io/jersey/Jersey-Singleton-%EA%B0%9D%EC%B2%B4%EC%9D%98-%EC%B4%88%EA%B8%B0%ED%99%94-%EC%8B%9C%EC%A0%90/">


  <meta property="og:description" content="이슈    현재 운영 중인 Jersey 기반의 서비스 중에 애플리케이션 구동 시점에 응답시간이 지연되는 이슈가 있었다.   구동 시점에만 이슈가 발생했기 때문에 무엇인가 초기화가 늦어지는 것으로 추측하고, 살펴보기 시작했다.">







  <meta property="article:published_time" content="2024-12-21T00:00:00+09:00">





  

  


<link rel="canonical" href="https://dreamsh19.github.io/jersey/Jersey-Singleton-%EA%B0%9D%EC%B2%B4%EC%9D%98-%EC%B4%88%EA%B8%B0%ED%99%94-%EC%8B%9C%EC%A0%90/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "서버 개발자",
      "url": "https://dreamsh19.github.io/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="기술을 기술하다 Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          기술을 기술하다
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/">Home</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">ㅎㅅㅎ</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Backend Dev</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">South Korea</span>
        </li>
      

      
        
          
        
          
        
          
        
          
        
          
            <li><a href="https://github.com/dreamsh19" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/dreamsh19" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
        
      

      

      
        <li>
          <a href="mailto:dreamsh19@gmail.com">
            <meta itemprop="email" content="dreamsh19@gmail.com">
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  <a href="https://hits.seeyoufarm.com" style="display: none;">
    <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fdreamsh19.github.io&count_bg=%2348AFB3&title_bg=%237D8B8E&icon=&icon_color=%23360E0E&title=hits&edge_flat=false">
  </a>  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Jersey Singleton 객체의 초기화 시점">
    <meta itemprop="description" content="이슈  현재 운영 중인 Jersey 기반의 서비스 중에 애플리케이션 구동 시점에 응답시간이 지연되는 이슈가 있었다.  구동 시점에만 이슈가 발생했기 때문에 무엇인가 초기화가 늦어지는 것으로 추측하고, 살펴보기 시작했다.">
    <meta itemprop="datePublished" content="2024-12-21T00:00:00+09:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Jersey Singleton 객체의 초기화 시점
</h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
<li><a href="#%EC%9D%B4%EC%8A%88">이슈</a></li>
<li>
<a href="#%ED%81%B4%EB%9E%98%EC%8A%A4%EC%9D%98-%EC%B4%88%EA%B8%B0%ED%99%94-%EC%8B%9C%EC%A0%90">클래스의 초기화 시점</a><ul><li><a href="#jls-1241%EC%97%90-%EB%AA%85%EC%8B%9C%EB%90%9C-%EC%8A%A4%ED%8E%99">JLS 12.4.1에 명시된 스펙</a></li></ul>
</li>
<li>
<a href="#%ED%95%B4%EA%B2%B0%EB%B0%A9%EC%95%88">해결방안</a><ul>
<li><a href="#1-spring%EA%B3%BC%EC%9D%98-%ED%86%B5%ED%95%A9">1. Spring과의 통합</a></li>
<li><a href="#2-immediate%EB%A5%BC-%ED%86%B5%ED%95%9C-%ED%95%B4%EA%B2%B0">2. @Immediate를 통한 해결</a></li>
</ul>
</li>
<li><a href="#%EB%B2%88%EC%99%B81-singleton%EC%9D%98-%EA%B5%AC%ED%98%84%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%B4%88%EA%B8%B0%ED%99%94-%EC%8B%9C%EC%A0%90-%EC%B0%A8%EC%9D%B4">번외1. Singleton의 구현에 따른 초기화 시점 차이</a></li>
<li><a href="#%EB%B2%88%EC%99%B82-spring%EA%B3%BC-%EC%A7%80%EC%97%B0-%EC%B4%88%EA%B8%B0%ED%99%94">번외2. Spring과 지연 초기화</a></li>
<li><a href="#references">References</a></li>
</ul>

            </nav>
          </aside>
        
        <h2 id="이슈">이슈</h2>
<ul>
  <li>현재 운영 중인 Jersey 기반의 서비스 중에 애플리케이션 구동 시점에 응답시간이 지연되는 이슈가 있었다.</li>
  <li>구동 시점에만 이슈가 발생했기 때문에 무엇인가 초기화가 늦어지는 것으로 추측하고, 살펴보기 시작했다.</li>
</ul>

<h2 id="클래스의-초기화-시점">클래스의 초기화 시점</h2>

<p>초기화 지연을 의심하여 애플리케이션 내에서 사용하는 Singleton 객체의 초기화 시점에 로그를 찍도록 했다.<br>
예상은 애플리케이션 구동 시점에 모두 초기화될 것으로 예상하였으나, 결과는 놀랍게도 실제 호출 시점에 초기화가 이루어졌다. 그래서 이러한 현상이 발생하는 이유를 찾아보기 시작했다.</p>

<p>초기화가 늦게 이루어지는 클래스는 아래와 같이 Singleton 형태로 구현되어 있었고, 사용하는 쪽에서는 ServiceA.getInstance() 형태로 호출하고 있었다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceA</span> <span class="o">{</span>  
	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ServiceA</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServiceA</span><span class="o">();</span>  
  
    <span class="kd">private</span> <span class="nf">ServiceA</span><span class="o">()</span> <span class="o">{}</span>
  
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ServiceA</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>  
        <span class="k">return</span> <span class="no">INSTANCE</span><span class="o">;</span>  
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>코드에서 보면 명확하듯이, 클래스가 로딩되는 시점에 static 변수인 INSTANCE 객체가 초기화될 것이라고 생각했고, 그래서 클래스는 애플리케이션 구동 시점에 로딩될테니, 애플리케이션 구동 시점에 Singleton 객체인 INSTANCE가 초기화된다고 생각하고 있었다.</p>

<p>그러나 관련해서 좀 더 찾아보다보니, 여기서 한가지 놓치고 있었던 전제가 있었다.<br>
클래스가 로딩되는 시점에 초기화가 되는 것은 맞지만, 애플리케이션 구동 시점에 클래스가 로딩되는가? 에 대한 전제이다.</p>

<p>그리고 결론부터 이야기하면, 자바의 스펙상, 필요하지 않는 클래스는 미리 로딩하지 않는다.</p>

<h3 id="jls-1241에-명시된-스펙">JLS 12.4.1에 명시된 스펙</h3>

<p>JLS(Java Language Spec)에는 클래스의 초기화 시점을 아래와 같이 정의하고 있다.</p>

<blockquote>
  <p>A class or interface type T will be initialized immediately before the first occurrence of any one of the following:</p>

  <ul>
    <li>T is a class and an instance of T is created.</li>
    <li>A <code class="language-plaintext highlighter-rouge">static</code> method declared by T is invoked.</li>
    <li>A <code class="language-plaintext highlighter-rouge">static</code> field declared by T is assigned.</li>
    <li>A <code class="language-plaintext highlighter-rouge">static</code> field declared by T is used and the field is not a constant variable (<a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-4.html#jls-4.12.4" title="4.12.4. final Variables">§4.12.4</a>).</li>
  </ul>
</blockquote>

<p>위와 같이 초기화 시점에 대한 구체적인 케이스에 대해 표현되어있지만, 요약하자면 실제로 “필요한 시점에 초기화한다”가 핵심이며, 이때 필요한 시점이라는 것은 클래스에 정의된 필드, 메소드에 접근하는 최초 시점을 의미한다. 결국, 클래스 로딩 역시 최대한 lazy하게 수행하는 것이 자바의 스펙이다.<br>
(클래스 초기화에 대한 참고용으로 위 JLS 문서의 클래스 초기화 예제들을 보면, 필요하지 않는 클래스는 절대 초기화하지 않도록 하는, 극단적으로 lazy하게 수행하도록 강제하는 것을 확인할 수 있다.)</p>

<hr>
<p>그럼 위와 같은 스펙에 대한 이해를 바탕으로 처음 ServiceA의 코드를 살펴보자.<br>
결국 ServiceA의 코드는 애플리케이션 로딩 시점에 클래스 로딩을 강제할 요소가 전혀 없다. 그렇기 때문에 <code class="language-plaintext highlighter-rouge">ServiceA.getInstance()</code>함수가 호출되는 시점에서야 ServiceA의 로딩이 일어나게 된다.</p>

<h2 id="해결방안">해결방안</h2>

<p>처음으로 돌아가, 결국 문제의 원인은 ServiceA의 초기화 시점이 애플리케이션 구동 시점이 아닌 실제 사용 시점이기 때문이다.<br>
그렇다면 해결 방법은 ServiceA를 애플리케이션 구동 시점에 초기화하도록 하면 된다.<br>
이를 위한 구체적인 방법은 아래와 같다.</p>

<p>아래 해결방안에 대해 부연설명을 추가하자면, ServiceA.getInstance() 를 Resource 레벨(스프링에서의 Controller)에서의 생성자에서 호출하고 있었는데, 결국 근본적으로 Resource가 지연 초기화 방식으로 동작하고 있었고, 그것으로 인해 발생한 문제라고 볼 수 있다.<br>
Resource가 즉시 초기화가 된다면, Resource 초기화 시점에 ServiceA도 초기화가 될 것이기 때문에 결국 Resource를 즉시 초기화할 수 있는 방법에 대해 검토하였다.</p>

<h3 id="1-spring과의-통합">1. Spring과의 통합</h3>

<p>Spring은 필요한 빈을 애플리케이션 구동 시점에 eager하게 모두 로딩하는 것이 디폴트 설정이다.<br>
그리고 아래와 같이 jersey-spring 의존성을 추가하면 Spring beans와 Jersey를 함께 사용할 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
	<span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">glassfish</span><span class="o">.</span><span class="na">jersey</span><span class="o">.</span><span class="na">ext</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
	<span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">jersey</span><span class="o">-</span><span class="n">spring3</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
	<span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="err">$</span><span class="o">{</span><span class="n">project</span><span class="o">.</span><span class="na">version</span><span class="o">}&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>예제 코드는 아래를 참고하면 된다.<br>
<img src="https://github.com/user-attachments/assets/db10426a-9d20-4f95-a46b-ae246dc9f95d" alt="image"></p>
<ul>
  <li><a href="https://github.com/eclipse-ee4j/jersey/blob/2.28/examples/helloworld-spring-webapp/src/main/java/org/glassfish/jersey/examples/helloworld/spring/SpringRequestResource.java">jersey/examples/helloworld-spring-webapp/src/main/java/org/glassfish/jersey/examples/helloworld/spring/SpringRequestResource.java at 2.28 · eclipse-ee4j/jersey · GitHub</a></li>
</ul>

<p>그러나 이 방법은 애플리케이션의 복잡도를 증가시키기 때문에 기각하였다.</p>

<h3 id="2-immediate를-통한-해결">2. @Immediate를 통한 해결</h3>

<p>위처럼 새로운 의존성을 추가하지 않고, 기존의 Jersey의 기능을 활용하여 해결할 수 있는 방법을 찾고자했다.</p>

<p>Jersey는 의존성 주입(DI) 구현체로서 내부적으로 <a href="https://eclipse-ee4j.github.io/glassfish-hk2/">hk2</a>를 사용한다.<br>
그리고 hk2에서도 <code class="language-plaintext highlighter-rouge">@Immediate</code> annotation을 통해 즉시 초기화를 지원한다.</p>

<p>참고로, hk2는 디폴트 초기화 전략으로 지연 초기화를 채택하고 있다.<br>
<img src="https://github.com/user-attachments/assets/5f0e4377-1b37-4658-881f-3d00754a6969" alt="image"></p>
<ul>
  <li><a href="https://github.com/eclipse-ee4j/glassfish-hk2/blob/f80f98503c51ca9fd2f2b57def329b05dacab73a/hk2-api/src/main/java/org/glassfish/hk2/internal/ImmediateHelper.java#L93">glassfish-hk2/hk2-api/src/main/java/org/glassfish/hk2/internal/ImmediateHelper.java at f80f98503c51ca9fd2f2b57def329b05dacab73a · eclipse-ee4j/glassfish-hk2 · GitHub</a></li>
  <li><img src="https://github.com/user-attachments/assets/fb5f702d-788c-4d27-8301-d89b8040a14f" alt="image"></li>
</ul>

<p>그렇기 때문에 hk2에서 즉시 초기화를 하기 위해서는 <code class="language-plaintext highlighter-rouge">@Immediate</code> annotation을 통해 명시적으로 지정을 해주어야한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Path</span><span class="o">(</span><span class="s">"/monitor/l7check.html"</span><span class="o">)</span>  
<span class="nd">@Immediate</span>  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">L7Resource</span> <span class="o">{</span>
	<span class="c1">// 아래 세부 구현</span>
<span class="o">}</span>
</code></pre></div></div>

<p>그러나 이렇게만 설정하면 여전히 즉시 초기화가 일어나지 않는다. 그 이유는 위에서의 전역적인 초기화 전략이 여전히 지연 초기화로 설정되어 있기 때문이다.<br>
따라서 아래와 같은 설정을 통해 전역 설정을 Immediate을 활성화하도록 변경해주어야한다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ApplicationPath</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationConfig</span> <span class="kd">extends</span> <span class="nc">ResourceConfig</span> <span class="o">{</span>  
  
    <span class="nd">@Inject</span>  
    <span class="kd">public</span> <span class="nf">ApplicationConfig</span><span class="o">(</span><span class="nc">ServiceLocator</span> <span class="n">serviceLocator</span><span class="o">)</span> <span class="o">{</span>  
       <span class="nc">ServiceLocatorUtilities</span><span class="o">.</span><span class="na">enableImmediateScope</span><span class="o">(</span><span class="n">serviceLocator</span><span class="o">);</span>  
       <span class="n">register</span><span class="o">(</span><span class="nc">L7Resource</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
       <span class="c1">// 후략</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>위와 같이 설정하면, 애플리케이션 구동 시점에 싱글턴 객체가 모두 애플리케이션 구동 시점에 즉시 초기화되는 것을 확인할 수 있다.</p>

<h2 id="번외1-singleton의-구현에-따른-초기화-시점-차이">번외1. Singleton의 구현에 따른 초기화 시점 차이</h2>

<p>아래 두가지 코드는 Java에서 싱글톤의 구현으로 흔하게 볼 수 있는 구현이다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceA</span> <span class="o">{</span>  
	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ServiceA</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServiceA</span><span class="o">();</span>  
  
    <span class="kd">private</span> <span class="nf">ServiceA</span><span class="o">()</span> <span class="o">{</span>
	    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ServiceA instantiated"</span><span class="o">);</span>
    <span class="o">}</span>
  
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ServiceA</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>  
        <span class="k">return</span> <span class="no">INSTANCE</span><span class="o">;</span>  
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">doNothing</span><span class="o">()</span> <span class="o">{}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceB</span> <span class="o">{</span>  
  
    <span class="kd">private</span> <span class="nf">ServiceB</span><span class="o">()</span> <span class="o">{</span>
	    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ServiceB instantiated"</span><span class="o">);</span>
    <span class="o">}</span>
  
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Singleton</span> <span class="o">{</span>  
        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ServiceB</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServiceB</span><span class="o">();</span>  
    <span class="o">}</span>  
  
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ServiceB</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>  
        <span class="k">return</span> <span class="nc">Singleton</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">;</span>  
    <span class="o">}</span>  
  
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">doNothing</span><span class="o">()</span> <span class="o">{}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>실제로 서비스 중인 코드에도 두가지 구현이 혼재되어 있었다.<br>
사실 이 이슈를 살펴보기 전까지는 A와 B의 차이가 없다고 생각해서 무엇을 쓰든 상관없다고 생각했다. 왜냐하면, 애플리케이션 구동 시점에 모든 클래스가 항상 로딩된다고 생각했고, 그런 관점에서는 두 코드의 동작에 차이가 없기 때문이다.<br>
그런데, 위에서 살펴본 것처럼 모든 클래스는 항상 로딩되는 것이 아니고 필요한 시점에서야 lazy하게 로딩됨을 알았다. 이 사실을 알고나면, 두 가지 구현은 실제 동작에서 분명한 차이가 발생한다.</p>

<p>실제로 아래와 같은 코드를 수행해보면 그 차이를 명확하게 확인할 수 있다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>  
  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestRunner</span> <span class="o">{</span>  
    
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testA</span><span class="o">(){</span>  
        <span class="nc">ServiceA</span><span class="o">.</span><span class="na">doNothing</span><span class="o">();</span>  
    <span class="o">}</span>  
  
    <span class="nd">@Test</span>  
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testB</span><span class="o">(){</span>  
        <span class="nc">ServiceB</span><span class="o">.</span><span class="na">doNothing</span><span class="o">();</span>  
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>테스트 수행 결과 <code class="language-plaintext highlighter-rouge">ServiceA instantiated</code>만 출력된다.</p>

<p>ServiceA는 doNothing() static 메소드를 호출하면서 ServiceA 클래스가 로딩되고, 로딩될때 static 변수인 INSTANCE가 초기화된다.<br>
그러나, ServiceB는 doNothing() static 메소드를 호출할때 ServiceB 클래스가 마찬가지로 로딩되지만, 이것이 ServiceB.Singleton 클래스의 로딩을 강제하지 않기 때문에, INSTANCE는 초기화되지 않는다. 그리고 실제로 ServiceB.getInstance()를 호출하는 시점에서야 ServiceB.Singleton 클래스가 로딩되면서 INSTANCE 객체가 초기화된다.<br>
그리고 ServiceB의 구현 방식을 Lazy Holder 방식이라고 부르는 것 같고, 실제로 가장 많이 쓰인다고 한다.</p>

<h2 id="번외2-spring과-지연-초기화">번외2. Spring과 지연 초기화</h2>

<p>스프링 공식 문서에 따르면, 지연 초기화의 단점에 대해 아래와 같이 설명하면서, 디폴트로 지연 초기화가 아닌 즉시 초기화를 채택한 이유에 대해 설명하고 있다.</p>
<blockquote>
  <p> There are a few downsides to lazy initialization that mean we believe it’s better to opt-in once you have decided it makes sense to do so. Due to classes no longer being loaded and beans no longer being created until they’re needed, it’s possible for lazy initialization to mask a problem that previously would have been identified at startup. Such problems can include no class def found errors, out of memory errors, and failures due to misconfiguration.</p>
</blockquote>

<p>결국 fail-fast 관점에서 지연 초기화는 별로 바람직하지 않고, 빈 초기화에 실패한다면 애플리케이션 구동 시점에 빠르게 실패하는 것이 대부분의 경우 바람직하다.<br>
(그외에 지연 초기화가 의미 있는 경우에 대해 궁금하다면 <a href="https://spring.io/blog/2019/03/14/lazy-initialization-in-spring-boot-2-2">Lazy Initialization in Spring Boot 2.2</a> 문서를 참고하면 좋을듯 하다)</p>

<p>참고로 Spring에서도 지연 초기화를 활성화하고 싶다면 빈에 <code class="language-plaintext highlighter-rouge">@Lazy</code> annotation을 지정함으로써 활성화할 수 있으며, Spring boot 2.2 부터는 <code class="language-plaintext highlighter-rouge">spring.main.lazy-initialization=true</code> 설정을 통해 지연 초기화를 전역적으로 활성화할 수 있다.</p>

<h2 id="references">References</h2>

<ul>
  <li>https://docs.oracle.com/javase/specs/jls/se8/html/jls-12.html#jls-12.4.1</li>
  <li><a href="https://stackoverflow.com/questions/35344767/how-to-initialize-injected-value-before-rest-call">web services - How to initialize injected value before REST call? - Stack Overflow</a></li>
  <li><a href="https://stackoverflow.com/questions/28114602/how-do-i-get-my-jersey-2-endpoints-to-eagerly-initialize-on-startup">java - How do I get my Jersey 2 Endpoints to eagerly initialize on startup? - Stack Overflow</a></li>
  <li><a href="https://stackoverflow.com/questions/36186102/initialize-singleton-in-java-jersey-2-jax-rs">rest - Initialize singleton in Java Jersey 2 JAX-RS - Stack Overflow</a></li>
  <li><a href="https://eclipse-ee4j.github.io/glassfish-hk2/">GlassFish HK2 - Dependency Injection Kernel</a></li>
  <li><a href="https://github.com/eclipse-ee4j/glassfish-hk2">GitHub - eclipse-ee4j/glassfish-hk2: Dynamic dependency injection framework</a></li>
  <li><a href="https://docs.spring.io/spring-boot/docs/2.2.3.RELEASE/reference/html/spring-boot-features.html#boot-features-lazy-initialization">Spring Boot Features</a></li>
  <li><a href="https://effortguy.tistory.com/266">[Spring] Bean Lazy Initialization 사용법</a></li>
  <li><a href="https://spring.io/blog/2019/03/14/lazy-initialization-in-spring-boot-2-2">Lazy Initialization in Spring Boot 2.2</a></li>
  <li><a href="https://robin00q.tistory.com/87">단일체 패턴 (Singleton Pattern)</a></li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#java" class="page__taxonomy-item" rel="tag">Java</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#jersey" class="page__taxonomy-item" rel="tag">Jersey</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#jersey" class="page__taxonomy-item" rel="tag">Jersey</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2024-12-21T00:00:00+09:00">December 21, 2024</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Jersey+Singleton+%EA%B0%9D%EC%B2%B4%EC%9D%98+%EC%B4%88%EA%B8%B0%ED%99%94+%EC%8B%9C%EC%A0%90%20https%3A%2F%2Fdreamsh19.github.io%2Fjersey%2FJersey-Singleton-%25EA%25B0%259D%25EC%25B2%25B4%25EC%259D%2598-%25EC%25B4%2588%25EA%25B8%25B0%25ED%2599%2594-%25EC%258B%259C%25EC%25A0%2590%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdreamsh19.github.io%2Fjersey%2FJersey-Singleton-%25EA%25B0%259D%25EC%25B2%25B4%25EC%259D%2598-%25EC%25B4%2588%25EA%25B8%25B0%25ED%2599%2594-%25EC%258B%259C%25EC%25A0%2590%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fdreamsh19.github.io%2Fjersey%2FJersey-Singleton-%25EA%25B0%259D%25EC%25B2%25B4%25EC%259D%2598-%25EC%25B4%2588%25EA%25B8%25B0%25ED%2599%2594-%25EC%258B%259C%25EC%25A0%2590%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/async/%EB%B9%84%EB%8F%99%EA%B8%B0-%EB%85%BC%EB%B8%94%EB%9D%BD%ED%82%B9%EC%97%90-%EB%8C%80%ED%95%9C-%EC%9D%B4%ED%95%B4/" class="pagination--pager" title="비동기 논블락킹에 대한 이해
">Previous</a>
    
    
      <a href="/git/%EC%A4%91%EB%B3%B5-%EC%BD%94%EB%93%9C%EC%9D%98-git-%ED%9E%88%EC%8A%A4%ED%86%A0%EB%A6%AC%EB%A5%BC-%EB%B3%91%ED%95%A9%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%9C-%EC%8B%9C%ED%96%89%EC%B0%A9%EC%98%A4/" class="pagination--pager" title="중복 코드의 Git 히스토리를 병합하기 위한 시행착오
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term...">
  </form>
  <div id="results" class="results"></div>
</div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/dreamsh19" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
        
          <li><a href="https://www.linkedin.com/in/dreamsh19" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2025 서버 개발자. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LM91QEFQ4D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LM91QEFQ4D', { 'anonymize_ip': false});
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://dreamsh19.github.io/jersey/Jersey-Singleton-%EA%B0%9D%EC%B2%B4%EC%9D%98-%EC%B4%88%EA%B8%B0%ED%99%94-%EC%8B%9C%EC%A0%90/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/jersey/Jersey-Singleton-객체의-초기화-시점"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://dreamsh19-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>


  





  </body>
</html>
