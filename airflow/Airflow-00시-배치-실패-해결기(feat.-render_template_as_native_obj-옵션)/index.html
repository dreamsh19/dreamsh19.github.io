<!DOCTYPE html>
<!--
  Minimal Mistakes Jekyll Theme 4.21.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
--><html lang="en" class="no-js">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Airflow 00시 배치 실패 해결기(feat. render_template_as_native_obj 옵션) - 기술을 기술하다</title>
<meta name="description" content="이슈    Airflow 상에서 매시간(hourly) 도는 DAG가 어느 순간부터 00시대에만 항상 실패하는 이슈가 있었다.   해당 태스크는 실패하더라도, 플랜 B가 동작하기 때문에 서비스에 지장은 없었지만, 반복적으로 00시에 실패하는 것이 우연이 아닐 것이라 생각하여 자세히 살펴보기 시작했다.">


  <meta name="author" content="ㅎㅅㅎ">
  
  <meta property="article:author" content="ㅎㅅㅎ">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="기술을 기술하다">
<meta property="og:title" content="Airflow 00시 배치 실패 해결기(feat. render_template_as_native_obj 옵션)">
<meta property="og:url" content="https://dreamsh19.github.io/airflow/Airflow-00%EC%8B%9C-%EB%B0%B0%EC%B9%98-%EC%8B%A4%ED%8C%A8-%ED%95%B4%EA%B2%B0%EA%B8%B0(feat.-render_template_as_native_obj-%EC%98%B5%EC%85%98)/">


  <meta property="og:description" content="이슈    Airflow 상에서 매시간(hourly) 도는 DAG가 어느 순간부터 00시대에만 항상 실패하는 이슈가 있었다.   해당 태스크는 실패하더라도, 플랜 B가 동작하기 때문에 서비스에 지장은 없었지만, 반복적으로 00시에 실패하는 것이 우연이 아닐 것이라 생각하여 자세히 살펴보기 시작했다.">







  <meta property="article:published_time" content="2024-03-17T00:00:00+09:00">





  

  


<link rel="canonical" href="https://dreamsh19.github.io/airflow/Airflow-00%EC%8B%9C-%EB%B0%B0%EC%B9%98-%EC%8B%A4%ED%8C%A8-%ED%95%B4%EA%B2%B0%EA%B8%B0(feat.-render_template_as_native_obj-%EC%98%B5%EC%85%98)/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "서버 개발자",
      "url": "https://dreamsh19.github.io/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="기술을 기술하다 Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          기술을 기술하다
          
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/">Home</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">ㅎㅅㅎ</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Backend Dev</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">South Korea</span>
        </li>
      

      
        
          
        
          
        
          
        
          
        
          
            <li><a href="https://github.com/dreamsh19" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/dreamsh19" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
        
      

      

      
        <li>
          <a href="mailto:dreamsh19@gmail.com">
            <meta itemprop="email" content="dreamsh19@gmail.com">
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  <a href="https://hits.seeyoufarm.com" style="display: none;">
    <img src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fdreamsh19.github.io&count_bg=%2348AFB3&title_bg=%237D8B8E&icon=&icon_color=%23360E0E&title=hits&edge_flat=false">
  </a>  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Airflow 00시 배치 실패 해결기(feat. render_template_as_native_obj 옵션)">
    <meta itemprop="description" content="이슈  Airflow 상에서 매시간(hourly) 도는 DAG가 어느 순간부터 00시대에만 항상 실패하는 이슈가 있었다.  해당 태스크는 실패하더라도, 플랜 B가 동작하기 때문에 서비스에 지장은 없었지만, 반복적으로 00시에 실패하는 것이 우연이 아닐 것이라 생각하여 자세히 살펴보기 시작했다.">
    <meta itemprop="datePublished" content="2024-03-17T00:00:00+09:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Airflow 00시 배치 실패 해결기(feat. render_template_as_native_obj 옵션)
</h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
<li><a href="#%EC%9D%B4%EC%8A%88">이슈</a></li>
<li><a href="#%EC%9B%90%EC%9D%B8-%ED%8C%8C%EC%95%85">원인 파악</a></li>
<li><a href="#int-%ED%83%80%EC%9E%85%EC%9D%98-%ED%8F%AC%EB%A7%B7%ED%8C%85-%EC%9D%B4%EC%8A%88%EA%B0%80-%EC%95%84%EB%8B%90%EA%B9%8C">int 타입의 포맷팅 이슈가 아닐까?</a></li>
<li><a href="#airflow-%ED%85%9C%ED%94%8C%EB%A6%BF-%EB%82%B4%EB%B6%80-%EB%8F%99%EC%9E%91">Airflow 템플릿 내부 동작</a></li>
<li><a href="#%ED%95%B4%EA%B2%B0">해결</a></li>
<li><a href="#%EC%B6%94%EA%B0%80%EC%A0%81%EC%9D%B8-%EA%B6%81%EA%B8%88%EC%A6%9D">추가적인 궁금증</a></li>
<li><a href="#references">References</a></li>
</ul>

            </nav>
          </aside>
        
        <h2 id="이슈">이슈</h2>
<ul>
  <li>Airflow 상에서 매시간(hourly) 도는 DAG가 어느 순간부터 00시대에만 항상 실패하는 이슈가 있었다.</li>
  <li>해당 태스크는 실패하더라도, 플랜 B가 동작하기 때문에 서비스에 지장은 없었지만, 반복적으로 00시에 실패하는 것이 우연이 아닐 것이라 생각하여 자세히 살펴보기 시작했다.</li>
</ul>

<h2 id="원인-파악">원인 파악</h2>
<ul>
  <li>문제가 된 DAG 내 태스크는 하둡 특정 시간대의 디렉토리의 파일 존재여부를 체크하는 PythonSensor 오퍼레이터로 작성된 태스크였다.</li>
  <li>구체적으로는, 아래와 같은 형태였다.
    <ul>
      <li>이때 날짜(date)와 시간(hour)은 배치 수행시간(<code class="language-plaintext highlighter-rouge">data_interval_start</code>)에서 파싱해서 가져온다.</li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check_flag_file</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">hour</span><span class="p">):</span>
	<span class="n">file_path</span><span class="o">=</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">conf</span><span class="p">.</span><span class="n">hdfs</span><span class="si">}</span><span class="s">/dt=</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s">/hr=</span><span class="si">{</span><span class="n">hour</span><span class="si">}</span><span class="s">/_*</span><span class="sh">'</span>
	<span class="o">//</span> <span class="n">후략</span>  
  
<span class="n">check_</span><span class="err"></span><span class="n">success</span> <span class="o">=</span> <span class="nc">PythonSensor</span><span class="p">(</span>
	<span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">check_success</span><span class="sh">'</span><span class="p">,</span>
	<span class="n">python_callable</span><span class="o">=</span><span class="n">check_flag_file</span><span class="p">,</span>
	<span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">:</span> <span class="n">date</span><span class="p">,</span> <span class="sh">"</span><span class="s">hour</span><span class="sh">"</span><span class="p">:</span> <span class="n">hour</span><span class="p">},</span>
	<span class="n">poke_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
	<span class="o">//</span> <span class="n">후략</span>
<span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>그래서 실패한 자정 시간대의 태스크 기록을 보니, 아래와 같이 ‘00’의 형태가 아닌 ‘0’으로 들어가고 있었다.</li>
</ul>

<p><img src="https://github.com/dreamsh19/dreamsh19.github.io/assets/47855638/4a50124f-a837-4681-8ead-68f8a6b4ece5" alt="image"></p>

<ul>
  <li>타겟 디렉토리명은 시간이 두자리로 포맷팅된 형태였고, <code class="language-plaintext highlighter-rouge">hr=00</code> 이 아닌 <code class="language-plaintext highlighter-rouge">hr=0</code> 디렉토리를 조회하니, 항상 존재하지 않아 태스크가 실패했던 것이다.</li>
  <li>그럼 직접적인 원인은 확인했으니, 왜 ‘00’이 아닌 ‘0’으로 들어가고 있는지 더 자세히 알아보기 시작했다.</li>
</ul>

<h2 id="int-타입의-포맷팅-이슈가-아닐까">int 타입의 포맷팅 이슈가 아닐까?</h2>
<p>00이 0으로 바뀌었으니, 처음으로 든 생각은 int 타입의 변수가 어떠한 이유로 한자리로 포맷팅되면서 발생한 이슈가 아닐까?라는 생각이었다.<br>
그러나, 단순 포맷팅 문제라면, 00시 뿐만 아니라, 01시, 02시부터 09시까지 모두 문제가 됐어야했다.<br>
하지만 실제로 문제가 된건 00시 뿐이었고, 01시~09시까지는 의도대로 두자리수로 처리되어 문제가 없었다.<br>
그래서 단순 포맷팅 이슈는 아닐꺼라고 판단하여 구체적으로 변수가 변환되는 과정을 추적하기 시작했다.</p>

<h2 id="airflow-템플릿-내부-동작">Airflow 템플릿 내부 동작</h2>

<p>위의 태스크 기록을 봤을때 kwargs로 들어갈때 이미 ‘0’이 들어갔다는 것은 곧 템플릿이 렌더링된 시점에 이미 ‘0’이 되어버린 것이다. 그래서 airflow의 템플릿의 동작 방식을 알아보기 시작했다.<br>
airflow는 템플릿 문법을 지원하며, 내부적으로 템플릿 엔진으로 jinja를 채택하고 있다.</p>
<ul>
  <li><a href="https://airflow.apache.org/docs/apache-airflow/stable/core-concepts/operators.html#jinja-templating">https://airflow.apache.org/docs/apache-airflow/stable/core-concepts/operators.html#jinja-templating</a></li>
</ul>

<p>그래서 문서를 읽던 중, <code class="language-plaintext highlighter-rouge">render_template_as_native_obj</code> 옵션에 대한 이야기가 있었고, 이 내용이 눈에 띄었다. 이 옵션이 눈에 띈 이유는 최근에 해당 DAG에 <code class="language-plaintext highlighter-rouge">render_template_as_native_obj=True</code> 옵션을 적용하는 배포가 있었기 때문이다.<br>
해당 옵션은 템플릿화된 변수를 렌더링할때, 단순문자열(디폴트 설정, <code class="language-plaintext highlighter-rouge">render_template_as_native_obj=False</code>)로 렌더링할 것이냐, 아니면 문자열을 파싱해서 파이썬 내장 객체로 렌더링할 것이냐를 지정하는 옵션이다.<br>
공식 문서에서 설명하고 있는 사용 예시는, dict 형태의 input을 전달받고 싶을때 해당 옵션을 켜줌으로써 <code class="language-plaintext highlighter-rouge">string -&gt; dict</code>로의 변환을 개발자가 아닌 airflow 설정만으로 가능하게 한다.</p>

<p><img src="https://github.com/dreamsh19/dreamsh19.github.io/assets/47855638/cb310bce-69dd-4378-8259-c85baa3f541f" alt="image"></p>

<p>그래서 최근에 해당 옵션이 적용된 만큼, 실제 설정을 적용했을때의 내부 동작을 좀더 확인해보기 시작했다.</p>

<p><code class="language-plaintext highlighter-rouge">render_template_as_native_obj</code> 옵션을 켜면, 내부적으로 jinja2의 <a href="https://jinja.palletsprojects.com/en/2.11.x/nativetypes/">NativeEnvironment</a>의 render() 함수를 활용하여 파이썬 내장객체를 리턴한다.<br>
그래서 NativeEnvironment의 render() 함수의 소스코드를 살펴보았고, 일부를 발췌했다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">//</span> <span class="n">전략</span>
<span class="k">try</span><span class="p">:</span>
	<span class="k">return</span> <span class="nf">literal_eval</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
<span class="nf">except </span><span class="p">(</span><span class="nb">ValueError</span><span class="p">,</span> <span class="nb">SyntaxError</span><span class="p">,</span> <span class="nb">MemoryError</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">raw</span>
</code></pre></div></div>
<ul>
  <li><a href="https://github.com/pallets/jinja/blob/aa3d688a15aece0a0de0b59f94dda870c724bc87/src/jinja2/nativetypes.py#L32-L35">jinja/src/jinja2/nativetypes.py at aa3d688a15aece0a0de0b59f94dda870c724bc87 · pallets/jinja · GitHub</a></li>
</ul>

<p>결국 내부적으로 ast.literal_eval() 함수를 호출하여 문자열을 내장객체로 파싱하고, 예외가 발생(파싱에 실패)하는 경우 raw, 즉 문자열 원본을 그대로 리턴하는 로직이다.<br>
(ast는 Abstract Syntax Trees를 의미하는 파이썬 내장 패키지이며, 일종의 파이썬 문법을 파싱하는 패키지정도로 이해했다.)</p>

<p>그렇다면, ast.literal_eval() 함수의 리턴 결과를 직접 확인해보기로 했다. (현재 팀에서 airflow를 구성하는데 사용한 python 3.6.5 버전으로 확인했다)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server ~]<span class="nv">$ </span>python3
Python 3.6.5 <span class="o">(</span>default, May  8 2018, 12:10:43<span class="o">)</span>
<span class="o">[</span>GCC 4.4.7 20120313 <span class="o">(</span>Red Hat 4.4.7-18<span class="o">)]</span> on linux
Type <span class="s2">"help"</span>, <span class="s2">"copyright"</span>, <span class="s2">"credits"</span> or <span class="s2">"license"</span> <span class="k">for </span>more information.
<span class="o">&gt;&gt;&gt;</span> import ast
<span class="o">&gt;&gt;&gt;</span> res <span class="o">=</span> ast.literal_eval<span class="o">(</span><span class="s1">'00'</span><span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> res
0
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="o">(</span>res<span class="o">)</span>
&lt;class <span class="s1">'int'</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>확인 결과, 문제가 됐던 상황처럼 문자열 ‘00’이 int 0으로 파싱되었다!</p>

<p>그렇다면 ‘01’은 int로 파싱이 안되는 것일까?</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> res <span class="o">=</span> ast.literal_eval<span class="o">(</span><span class="s1">'01'</span><span class="o">)</span>
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"&lt;stdin&gt;"</span>, line 1, <span class="k">in</span> &lt;module&gt;
  File <span class="s2">"/usr/local/lib/python3.6/ast.py"</span>, line 48, <span class="k">in </span>literal_eval
    node_or_string <span class="o">=</span> parse<span class="o">(</span>node_or_string, <span class="nv">mode</span><span class="o">=</span><span class="s1">'eval'</span><span class="o">)</span>
  File <span class="s2">"/usr/local/lib/python3.6/ast.py"</span>, line 35, <span class="k">in </span>parse
    <span class="k">return </span>compile<span class="o">(</span><span class="nb">source</span>, filename, mode, PyCF_ONLY_AST<span class="o">)</span>
  File <span class="s2">"&lt;unknown&gt;"</span>, line 1
    01
     ^
SyntaxError: invalid token
</code></pre></div></div>

<p>‘01’은 파싱에 실패하여 SyntaxError가 발생하였다.<br>
그리고 위에 발췌한 NativeEnvironment의 render()의 구현에 따르면, SyntaxError가 발생한 경우 원본 문자열인 ‘01’을 리턴하게 된다.<br>
이것을 통해 ‘00’과 ‘01’의 파싱 결과가 다르다는 사실을 확인했다.</p>

<p>결국 이것을 확인함으로써 모든 것이 명확해졌다.<br>
<code class="language-plaintext highlighter-rouge">render_template_as_native_obj=True</code> 옵션을 적용하면서 템플릿을 렌더링하는 로직이 달라졌고,<br>
해당 옵션을 적용했을때의 템플릿 엔진이 문자열 ‘00’을 int 0으로 파싱하게 되면서 00시에는 오류가 발생했고,<br>
문자열 ‘01’은 파싱에 실패하여 문자열 원본 ‘01’이 그대로 리턴되면서 그외의 시간에는 문제가 발생하지 않았던 것이다.</p>

<h2 id="해결">해결</h2>

<p><code class="language-plaintext highlighter-rouge">render_template_as_native_obj</code> 옵션이 명확하게 원인인 것을 알았으니, 다시 사용하지 않는게 명확한 해결책이지만, 해당 옵션은 다른 태스크에서 활용하고 있었기 때문에 이 해결책은 기각하였다.</p>

<p>결국 우리에게 필요한 것은 아래와 같으므로,</p>
<ol>
  <li>int 0이 들어왔을때 00을 리턴한다.</li>
  <li>string ‘01’~’23’이 들어왔을때 01~23을 리턴한다.</li>
</ol>

<p>아래와 같이 명시적인 “형변환 후 포맷팅” 로직을 적용하여 해결하였다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">check_flag_file</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">hour</span><span class="p">):</span>
	<span class="n">file_path</span><span class="o">=</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">conf</span><span class="p">.</span><span class="n">hdfs</span><span class="si">}</span><span class="s">/dt=</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s">/hr=</span><span class="si">{</span><span class="nf">int</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span><span class="si">:</span><span class="mi">02</span><span class="si">}</span><span class="s">/_*</span><span class="sh">'</span>
	<span class="o">//</span> <span class="n">후략</span>  
</code></pre></div></div>

<p>결국 해결은 <code class="language-plaintext highlighter-rouge">render_template_as_native_obj</code> 옵션을 활용하진 않았지만, 해당 옵션에 대한 이해가 부족했다면, 적용하지 못했을 해결 방법이다.</p>

<h2 id="추가적인-궁금증">추가적인 궁금증</h2>

<p>위 내용을 통해 ast.literal_eval() 이 이 문제의 범인임은 알았다. 그렇다면 ‘00’은 int 0으로 파싱하면서 ‘01’은 파싱을 못하는 건 ast의 스펙인걸까?<br>
그래서 ast.literal_eval() 소스코드를 좀 더 살펴보기 시작했다.<br>
결국 ast 역시 파이썬 내장 compile() 함수에 파싱을 위임하고 있었다.<br>
<img src="https://github.com/dreamsh19/dreamsh19.github.io/assets/47855638/6c612f4d-41cf-4730-adf5-fb0f5d72b0ae" alt="image"></p>
<ul>
  <li><a href="https://github.com/python/cpython/blob/v3.6.5/Lib/ast.py#L35">cpython/Lib/ast.py at v3.6.5 · python/cpython · GitHub</a></li>
</ul>

<p>그럼 결국 이건 ast의 스펙이 아니고, 파이썬의 스펙이라는 것인데, 그래서 아래와 같이 확인해봤다.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@server ~]<span class="nv">$ </span>python3
Python 3.6.5 <span class="o">(</span>default, May  8 2018, 12:10:43<span class="o">)</span>
<span class="o">[</span>GCC 4.4.7 20120313 <span class="o">(</span>Red Hat 4.4.7-18<span class="o">)]</span> on linux
Type <span class="s2">"help"</span>, <span class="s2">"copyright"</span>, <span class="s2">"credits"</span> or <span class="s2">"license"</span> <span class="k">for </span>more information.
<span class="o">&gt;&gt;&gt;</span> <span class="nv">a</span><span class="o">=</span>00
<span class="o">&gt;&gt;&gt;</span> a
0
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="o">(</span>a<span class="o">)</span>
&lt;class <span class="s1">'int'</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nv">a</span><span class="o">=</span>01
  File <span class="s2">"&lt;stdin&gt;"</span>, line 1
    <span class="nv">a</span><span class="o">=</span>01
       ^
SyntaxError: invalid token
</code></pre></div></div>

<p>확인결과, 파이썬의 스펙인듯하다. 파이썬 문법상 리터럴 00은 int 0으로 파싱되지만, 리터럴 01은 파싱에 실패한다.</p>

<p>이걸 이상하게 생각하는 건 나뿐만이 아니었던 듯하다. 관련해서 구글링을 해보니 아래와 같은 글을 찾을 수 있었다.<br>
<a href="https://stackoverflow.com/questions/31447694/why-does-python-3-allow-00-as-a-literal-for-0-but-not-allow-01-as-a-literal">Why does Python 3 allow “00” as a literal for 0 but not allow “01” as a literal for 1? - Stack Overflow</a></p>

<p>요약하자면, <code class="language-plaintext highlighter-rouge">"0"+</code>이 스페셜 케이스이고, 이걸 도입했을 당시의 명확한 이유가 기억이 나지 않는다고 한다;;<br>
그래서 많은 사람들이 이러한 스페셜 케이스를 없애자고 제안차 버그 리포트를 올렸으나, 반영이 되지 않아 현재까지 <code class="language-plaintext highlighter-rouge">"0"+</code> 리터럴은 0으로 파싱되고 있다고 한다.</p>

<p><img src="https://github.com/dreamsh19/dreamsh19.github.io/assets/47855638/d09100cc-6ea4-45d8-b3f9-99ede7820f31" alt="image"></p>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://airflow.apache.org/docs/apache-airflow/2.2.3/concepts/operators.html#jinja-templating">Operators — Airflow Documentation</a></li>
  <li><a href="https://jinja.palletsprojects.com/en/2.11.x/nativetypes/">Native Python Types — Jinja Documentation (2.11.x)</a></li>
  <li><a href="https://github.com/pallets/jinja/blob/aa3d688a15aece0a0de0b59f94dda870c724bc87/src/jinja2/nativetypes.py">jinja/src/jinja2/nativetypes.py at aa3d688a15aece0a0de0b59f94dda870c724bc87 · pallets/jinja · GitHub</a></li>
  <li><a href="https://github.com/python/cpython/blob/v3.6.5/Lib/ast.py">cpython/Lib/ast.py at v3.6.5 · python/cpython · GitHub</a></li>
  <li><a href="https://docs.python.org/3/library/ast.html#ast.literal_eval">ast — Abstract Syntax Trees — Python 3.12.2 documentation</a></li>
  <li><a href="https://stackoverflow.com/questions/31447694/why-does-python-3-allow-00-as-a-literal-for-0-but-not-allow-01-as-a-literal">Why does Python 3 allow “00” as a literal for 0 but not allow “01” as a literal for 1? - Stack Overflow</a></li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#airflow" class="page__taxonomy-item" rel="tag">Airflow</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#python" class="page__taxonomy-item" rel="tag">Python</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#airflow" class="page__taxonomy-item" rel="tag">Airflow</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2024-03-17T00:00:00+09:00">March 17, 2024</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Airflow+00%EC%8B%9C+%EB%B0%B0%EC%B9%98+%EC%8B%A4%ED%8C%A8+%ED%95%B4%EA%B2%B0%EA%B8%B0%28feat.+render_template_as_native_obj+%EC%98%B5%EC%85%98%29%20https%3A%2F%2Fdreamsh19.github.io%2Fairflow%2FAirflow-00%25EC%258B%259C-%25EB%25B0%25B0%25EC%25B9%2598-%25EC%258B%25A4%25ED%258C%25A8-%25ED%2595%25B4%25EA%25B2%25B0%25EA%25B8%25B0%28feat.-render_template_as_native_obj-%25EC%2598%25B5%25EC%2585%2598%29%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdreamsh19.github.io%2Fairflow%2FAirflow-00%25EC%258B%259C-%25EB%25B0%25B0%25EC%25B9%2598-%25EC%258B%25A4%25ED%258C%25A8-%25ED%2595%25B4%25EA%25B2%25B0%25EA%25B8%25B0%28feat.-render_template_as_native_obj-%25EC%2598%25B5%25EC%2585%2598%29%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fdreamsh19.github.io%2Fairflow%2FAirflow-00%25EC%258B%259C-%25EB%25B0%25B0%25EC%25B9%2598-%25EC%258B%25A4%25ED%258C%25A8-%25ED%2595%25B4%25EA%25B2%25B0%25EA%25B8%25B0%28feat.-render_template_as_native_obj-%25EC%2598%25B5%25EC%2585%2598%29%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/java/Java-Optional-Deep-Dive/" class="pagination--pager" title="Java Optional Deep Dive
">Previous</a>
    
    
      <a href="/https/%EB%A1%9C%EC%BB%AC%EC%97%90-HTTPS-%EC%9B%B9%EC%84%9C%EB%B2%84%EB%A5%BC-%EB%8F%84%EB%A9%94%EC%9D%B8%EA%B3%BC-%ED%95%A8%EA%BB%98-%EB%9D%84%EC%9B%8C%EB%B3%B4%EC%9E%90(feat.-mkcert)/" class="pagination--pager" title="로컬에-HTTPS-웹서버를-도메인과-함께-띄워보자(feat. mkcert)
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term...">
  </form>
  <div id="results" class="results"></div>
</div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/dreamsh19" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
        
          <li><a href="https://www.linkedin.com/in/dreamsh19" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2025 서버 개발자. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LM91QEFQ4D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-LM91QEFQ4D', { 'anonymize_ip': false});
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://dreamsh19.github.io/airflow/Airflow-00%EC%8B%9C-%EB%B0%B0%EC%B9%98-%EC%8B%A4%ED%8C%A8-%ED%95%B4%EA%B2%B0%EA%B8%B0(feat.-render_template_as_native_obj-%EC%98%B5%EC%85%98)/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/airflow/Airflow-00시-배치-실패-해결기(feat. render_template_as_native_obj 옵션)"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://dreamsh19-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>


  





  </body>
</html>
